<div class="content mat-elevation-z5">

  <div>
    <button mat-button color="primary" (click)="onBack()">
      <mat-icon>arrow_back</mat-icon>
      <p>Go back</p>
    </button>
    <button mat-button color="primary" (click)="addToWatchlist()">
      <mat-icon>add</mat-icon>
      <p>Add to watchlist</p>
    </button>

    <mat-form-field appearance="fill">
      <mat-label>Change chart</mat-label>
      <mat-select [(value)]="selectedChart">
        <mat-option value="area">Area</mat-option>
        <mat-option value="candlestick">Candle stick</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <!-- Loader -->
  <div class="spinbox" *ngIf="isLoading">
    <mat-progress-spinner color="primary" mode="indeterminate">
    </mat-progress-spinner>
  </div>
  <stockChart
    *ngIf="!isLoading"
    [dataPoints]="dataPoints"
    [ticker]="ticker!"
    [chartType]="selectedChart"
  ></stockChart>

  <!-- Stock information -->
  <mat-expansion-panel [expanded]="panelOpenState">
    <mat-expansion-panel-header matRipple>
      <mat-panel-title> <b>Company information</b> </mat-panel-title>
    </mat-expansion-panel-header>
    <div *ngIf="detailsLoaded">
      <h3>
        <span *ngIf="details.description == null"> There is no description of this security</span>
      </h3>
      <p>
        <span *ngIf="details.description"> {{details.description}} </span>
      </p>
      <div class="flexbox"> 
        <p>
          <span *ngIf="details.sector"> Sector - {{details.sector}} </span>
          <span *ngIf="details.primaryExchange"> Primary exchange  - {{details.primaryExchange}} </span>
          <span *ngIf="details.employees">  Employes - {{details.employees}} </span>
          <span *ngIf="details.country"> Based in - {{details.city}}, {{details.country}}</span>
          <span *ngIf="details.companyUrl"><a href={{details.companyUrl}}> {{details.companyUrl}}</a></span>
        </p>
      </div>  
    </div>
  </mat-expansion-panel>

  <!-- A.I assistance -->
  <mat-expansion-panel *ngIf="AIassistance" [expanded]="panelOpenState">
    <mat-expansion-panel-header matRipple>
      <mat-panel-title> <b>A.I. Assistance: trend forecast</b> </mat-panel-title>
    </mat-expansion-panel-header>
    <div *ngIf="detailsLoaded">
      <div class="flexbox"> 
        <p>
          Based upon our modelling, A.I. Assistance has predicted the following prices.
          <mat-icon
          class="info"
          [matTooltipClass]="{ 'tool-tip': true }"
          aria-label="Icon that displays a tooltip when focused or hovered over"
          matTooltip="A.I. assist is in its beta trial and could display incorrect answers. It should not be interpreted as investment advice."
        >
          information
        </mat-icon>
        </p>
        <div class="predictedPerformance">
          <table>
            <tr>
              <th>Current</th>
              <th>1 Day</th>
              <th>1 Week</th>
              <th>1 Month</th>
              <th>From now</th>
            </tr>
            <tr>
              <td>${{lastPrice | number : '1.2-2'}}</td>
              <td>${{prediction[0] | number : '1.2-2'}}</td>
              <td>${{prediction[6] | number : '1.2-2'}}</td>
              <td>${{prediction[29] | number : '1.2-2'}}</td>
              <td>
                <mat-icon class="positive" *ngIf="prediction[29] >= lastPrice!">trending_up</mat-icon>
                <mat-icon class="negative" *ngIf="prediction[29] <= lastPrice!">trending_down</mat-icon>
              </td>
            </tr>
          </table>
        </div>
        <p>
          Based upon current prices, this would be a short term (1 month)
          <ng-template *ngIf="prediction[29] > lastPrice!; else lessTxt">gain.</ng-template>
          <ng-template #lessTxt>loss.</ng-template>
       
           It is important to note, 
          stocks are volitile and the safest way to particpate is to average money consistently into the stocks you choose instead of trying to time the markets.
        </p>
      </div>  
    </div>
  </mat-expansion-panel>

  <!-- Company metrics -->
  <mat-expansion-panel [expanded]="panelOpenState">
    <mat-expansion-panel-header matRipple>
      <mat-panel-title> <b>Stock's valuation and other metrics</b> </mat-panel-title>
    </mat-expansion-panel-header>
    <div *ngIf="detailsLoaded">
      <h3>
        <span *ngIf="metrics.marketCap == null"> There is no information on this security</span>
      </h3>
      <div class="flexbox"> 
        
        <div class='row'>
          <div class='column' *ngIf="metrics.marketCap || metrics.forwardPE || metrics.profitMargins">
              <p>
                <b>Valuation</b>
                <span *ngIf="metrics.marketCap"> Market capitalization ${{metrics.marketCap}} ({{metrics.marketCapCompressed}}) </span> 
                <span *ngIf="metrics.forwardPE"> Forward price/equity (PE) ratio {{metrics.forwardPE}} </span>
                <span *ngIf="metrics.profitMargins">  Profit margin {{metrics.profitMargins}} </span>
              </p>
          </div>
          <div class='column' *ngIf="metrics.sharesOutstanding || metrics.sharesHeldByInsider || metrics.sharesHeldByInstituions">
            <p>
              <b>Who has what slice of the pie?</b>
              <span *ngIf="metrics.sharesOutstanding"> Shares outstanding {{metrics.sharesOutstanding}}</span>
              <span *ngIf="metrics.sharesHeldByInsider"> Shares held by insiders {{metrics.sharesHeldByInsider}}</span>
              <span *ngIf="metrics.sharesHeldByInstituions"> Shares held by insitutional investors {{metrics.sharesHeldByInstituions}}</span>
            </p>
          </div>
          <div class='column' *ngIf="metrics.yield || metrics.LastDividEnd || metrics.lastDividendValue">
            <p>
              <b>Dividend information</b>
              <span *ngIf="metrics.yield"> Yield percentage {{metrics.yield}}</span>
              <span *ngIf="metrics.LastDividEnd"> Last dividend date {{metrics.LastDividEnd}}</span>
              <span *ngIf="metrics.lastDividendValue"> Last dividend value {{metrics.lastDividendValue}}</span>
            </p>
          </div>
          <div class="column" *ngIf="metrics.fiftyTwoWeekchange || metrics.earningsQuarterlyGrowth || metrics.revenueQuarterlyGrowth">
            <p>
              <b>Performance</b>
              <span *ngIf="metrics.fiftyTwoWeekchange">52 Week change {{metrics.fiftyTwoWeekchange}}</span>
              <span *ngIf="metrics.earningsQuarterlyGrowth">Earnings quarterly growth {{metrics.earningsQuarterlyGrowth}}</span>
              <span *ngIf="metrics.revenueQuarterlyGrowth">Revenue quarterly growth {{metrics.revenueQuarterlyGrowth}}</span>
            </p>
          </div>
        </div>
      </div>  
    </div>
  </mat-expansion-panel>
</div>
