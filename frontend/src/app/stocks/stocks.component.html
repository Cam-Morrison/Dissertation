<div class="content mat-elevation-z5">
  <div class="center">
    <mat-form-field [formGroup]="searchForm" appearance="fill">
      <mat-label>Search for a stock</mat-label>
      <input 
      matInput 
      formControlName="search" 
      type="text"
      [matAutocomplete]="auto"
      />
      <mat-icon matPrefix>search</mat-icon>
      <mat-autocomplete #auto="matAutocomplete">
        <ng-container *ngIf="stockList.length && stockList[0] != 'No results'; else notFound">
        <mat-option  #found *ngFor="let stock of stockList" [value]="stock" [routerLink]="['/stocks', stock]">
          {{stock}}
        </mat-option>
        </ng-container>
        <ng-template #notFound>
          <mat-option #noResults>
            No results
          </mat-option>
        </ng-template>
      </mat-autocomplete>
    </mat-form-field>
  </div>

  <!-- Search results -->
  <!-- <div class="searchResults mat-elevation-z5">
    <ng-container *ngIf="stockList.length; else notFound">
      <div *ngFor="let stock of stockList">
        <h1>{{ stock }}</h1>
      </div>
    </ng-container>
    <ng-template #notFound>
      <div>
        <h1>Not found</h1>
      </div>
    </ng-template>
  </div> -->


  <table mat-table [dataSource]="dataSource">
    <!-- Ticker Column -->
    <ng-container matColumnDef="Ticker">
      <th mat-header-cell *matHeaderCellDef>Top winner</th>
      <td mat-cell *matCellDef="let element">
        {{ element.T }}
      </td>
    </ng-container>

    <!-- Volume Column -->
    <ng-container matColumnDef="PE ratio">
      <th mat-header-cell *matHeaderCellDef>
        P/E
        <mat-icon
        class="info"
        [matTooltipClass]="{ 'tool-tip': true }"
        aria-label="Icon that displays a tooltip when focused or hovered over"
        matTooltip=
        "P/E (Price to equity) ratio is the price of a share divided by the earnings per share. 
        Lower is considered better value but is not an indiciation of future performance."
      >
        information
      </mat-icon>
      </th>
      <td mat-cell *matCellDef="let element">
        {{ element.PE | number : "1.2-2" }}
      </td>
    </ng-container>

    <!-- Price Column -->
    <ng-container matColumnDef="Price">
      <th mat-header-cell *matHeaderCellDef>Price</th>
      <td mat-cell *matCellDef="let element">
        {{ element.P | currency : element.C : "symbol" : "1.2-3" }}
      </td>
    </ng-container>

    <!-- Close Column -->
    <ng-container matColumnDef="Rating">
      <th mat-header-cell *matHeaderCellDef>
        Rating
        <mat-icon
        class="info"
        [matTooltipClass]="{ 'tool-tip': true }"
        aria-label="Icon that displays a tooltip when focused or hovered over"
        matTooltip=
        "The rating of a share is the latest analyst recommendations for a company, 'strong buy' being the best and 'strong sell' being the worst.
        This data is provided by Finnhub.io and is not investment advice, apply your own due diligence."
      >
        information
      </mat-icon>
      </th>
      <td mat-cell *matCellDef="let element">
        {{ element.R }}
      </td>
    </ng-container>

    Change Column
    <ng-container matColumnDef="Change">
      <th mat-header-cell *matHeaderCellDef>Daily change</th>
      <td
        mat-cell
        *matCellDef="let element"
        [ngClass]="{
          positive: element.M > 0,
          negative: element.M < 0
        }"
      >
        <span *ngIf="element.M > 0">
          <mat-icon>trending_up</mat-icon>
        </span>
        <span *ngIf="element.M < 0">
          <mat-icon>trending_down</mat-icon>
        </span>
        <span *ngIf="element.M == 0">
          <mat-icon>trending_flat</mat-icon>
        </span>
        {{ element.M | number : "1.2-2" }}%
      </td>
    </ng-container>
    --> Table entries
    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      [routerLink]="['/stocks', row.S]"
    ></tr>
  </table>
  <!-- Loader -->
  <div class="spinbox" *ngIf="isLoading">
    <mat-progress-spinner color="primary" mode="indeterminate">
    </mat-progress-spinner>
  </div>
</div>
